# Deployment Guide for Render

This guide explains how to deploy the Amanah Elektronik API to Render.

## Prerequisites

- A [Render](https://render.com) account
- Git repository (GitHub, GitLab, or Bitbucket)
- The project pushed to your repository

## Deployment Steps

### 1. Push to Git Repository

First, commit and push all changes to your Git repository:

```bash
git add .
git commit -m "Add Render deployment configuration"
git push origin main
```

### 2. Create New Web Service on Render

1. Log in to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" → "Web Service"
3. Connect your Git repository
4. Select the repository containing this project

### 3. Configure the Service

Render will automatically detect the `render.yaml` file. If not, configure manually:

- **Name**: `amanah-elektronik-api`
- **Runtime**: Docker
- **Branch**: main (or your default branch)
- **Build Command**: (automatically handled by Dockerfile)
- **Start Command**: (automatically handled by Dockerfile)

### 4. Environment Variables

The following environment variables will be configured:

- `JWT_SECRET` - Automatically generated by Render
- `NODE_ENV` - Set to "production"
- `PORT` - Automatically set by Render
- `DATABASE_PATH` - Set to `/app/data/db.sqlite`

### 5. Database Persistence

#### Option A: SQLite with Disk (Requires Paid Plan)

1. Upgrade to a paid plan (Starter or higher)
2. Uncomment the disk configuration in `render.yaml`:

```yaml
disk:
  name: sqlite-data
  mountPath: /app/data
  sizeGB: 1
```

3. Redeploy the service

#### Option B: PostgreSQL (Recommended for Production)

1. Create a PostgreSQL database on Render (free tier available)
2. Update your database configuration to use PostgreSQL
3. Set the `DATABASE_URL` environment variable

### 6. Deploy

1. Click "Create Web Service"
2. Render will automatically build and deploy your application
3. Wait for the deployment to complete (usually 5-10 minutes)

## Post-Deployment

### Verify Deployment

1. Visit your app URL: `https://your-app-name.onrender.com`
2. Check the health endpoint: `https://your-app-name.onrender.com/api/health`
3. Test the API endpoints using your preferred tool

### Monitor Logs

- Access logs from the Render dashboard
- Check for any startup errors or issues

### Custom Domain (Optional)

1. Go to Settings → Custom Domains
2. Add your domain
3. Configure DNS as instructed by Render

## Important Notes

1. **Free Tier Limitations**:
   - Services spin down after 15 minutes of inactivity
   - First request after spin-down takes 30-60 seconds
   - SQLite data is lost on redeploy without persistent disk

2. **Production Recommendations**:
   - Use PostgreSQL instead of SQLite
   - Upgrade to a paid plan for better performance
   - Enable persistent disk for SQLite if needed
   - Set up monitoring and alerts

3. **Security**:
   - Never commit `.env` files
   - Use Render's environment variables for secrets
   - Enable HTTPS (automatic on Render)

## Troubleshooting

### Build Failures

- Check Dockerfile syntax
- Ensure all dependencies are listed in package.json
- Review build logs in Render dashboard

### Runtime Errors

- Check environment variables are set correctly
- Verify database migrations ran successfully
- Review application logs

### Database Issues

- For SQLite: Ensure disk is mounted (paid plan)
- For PostgreSQL: Verify DATABASE_URL is correct
- Check migration logs

## Local Testing with Docker

Test the Docker build locally:

```bash
# Build the image
docker build -t amanah-api .

# Run the container
docker run -p 8000:8000 -e JWT_SECRET=test-secret amanah-api
```

Visit http://localhost:8000 to verify it works.